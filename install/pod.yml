apiVersion: v1
kind: Namespace
metadata:
  name: test
---
apiVersion: v1
kind: Pod
metadata:
  name: test-web
  namespace: test
  labels:
    app: test-web
spec:
  initContainers:
  - name: init-content
    image: busybox:1.36
    command:
    - sh
    - -c
    - |
      echo '<html><body><h1>Kubernetes test</h1><p>Generated by init-container</p></body></html>' > /init/index.html
      echo "✓ index.html created"
    volumeMounts:
    - name: shared-content
      mountPath: /init
  containers:
  - name: web-server
    image: busybox:1.36
    command:
    - sh
    - -c
    - |
      echo "✓ Starting HTTP server on port 8000"
      httpd -f -p 8000 -h /test
    ports:
    - containerPort: 8000
      name: http
    volumeMounts:
    - name: shared-content
      mountPath: /test
    lifecycle:
      preStop:
        exec:
          command:
          - sh
          - -c
          - |
            echo "⚠️ Removing index.html before shutdown"
            rm -f /test/index.html
            sleep 1
  volumes:
  - name: shared-content
    emptyDir: {}
  restartPolicy: Never